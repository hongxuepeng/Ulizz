<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="img/favicon.png" type="image/png">
    <title>ULIZZ.COM荔枝租房</title>
    <link rel="shortcut icon" href="img/favicon.png" type="image/png">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="iCheck/skins/all.css">
    <link rel="stylesheet" href="css/sweetalert.css">
    <link href="css/register.css" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
    <script src="js/jquery-1.11.3.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/icheck.min.js"></script>
    <script src="js/sweetalert.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/md5.js"></script>
</head>
    <body>
        <input type="hidden" id="register-type" value="1">
        <div class="register-box">
            <div class="register-left"></div>
            <div class="register-right">
                <div class="register-group">
                    <ul class="register-tab">
                        <li class="register-tab-active" tabindex="1">手机注册</li>
                        <li tabindex="2">邮箱注册</li>
                    </ul>
                    <div class="register-content">
                        <div class="register-content-1">
                            <div class="login-modal-form padding-100">
                                <div class="login-modal-left">
                                    （+86）
                                </div>
                                <div class="login-modal-right">
                                    <input type="text" placeholder="请输入手机号" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                                           onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'0')}else{this.value=this.value.replace(/\D/g,'')}" id="phone-input">
                                </div>
                                <ul class="login-modal-menu" id="phone-key" data-key="+86">
                                    <li key="86">中国 (+86)</li>
                                    <!--<li key="1">美国 (+1)</li>-->
                                    <!--<li key="44">英国 (+44)</li>-->
                                    <!--<li key="61">澳大利亚 (+61)</li>-->
                                    <!--<li key="1">加拿大 (+1)</li>-->
                                </ul>
                            </div>
                            <div class="bind-modal-form specil-modal-form">
                                <div class="login-modal-right">
                                    <input type="text" id="phone-captcha" autocomplete="off" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                                           onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'0')}else{this.value=this.value.replace(/\D/g,'')}" placeholder="请输入6位验证码">
                                </div>
                                <div class="bind-modal-code phone-code">获取验证码</div>
                            </div>
                            <div class="login-modal-form">
                                <div class="login-modal-right">
                                    <input type="password" autocomplete="new-password" placeholder="设置8至15位英文+数字密码" id="phone-password">
                                </div>
                            </div>
                        </div>
                        <div class="register-content-2">
                            <div class="login-modal-form">
                                <div class="login-modal-right">
                                    <input type="text" placeholder="请输入邮箱账号" id="email-input">
                                </div>
                            </div>
                            <div class="bind-modal-form specil-modal-form">
                                <div class="login-modal-right">
                                    <input type="text" id="email-captcha" autocomplete="off" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                                           onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'0')}else{this.value=this.value.replace(/\D/g,'')}" placeholder="请输入6位验证码">
                                </div>
                                <div class="bind-modal-code email-code">获取验证码</div>
                            </div>
                            <div class="login-modal-form">
                                <div class="login-modal-right">
                                    <input type="password" autocomplete="new-password" placeholder="设置8至15位英文+数字密码" id="email-password">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="login-modal-tips">用户名或密码错误</div>
                    <div class="login-input-parent">
                        <span class="login-input">
                            <!--<input tabindex="1" type="checkbox" id="input-login">-->
                            <!--<label for="input-login">-->
                                <!--<span>已阅读并同意<a href="#">《用户服务协议》</a></span>-->
                            <!--</label>-->
                            <span class="login-input-tips">注册即同意<a href="#">《用户服务协议》</a></span>
                        </span>
                    </div>
                    <div class="login-modal-btn">立即注册</div>
                </div>
            </div>
        </div>
    </body>
<script>
    var url= 'http://47.106.83.149:8081/api';
    $(document).bind("click", function (e) {
        if (!$(".login-modal-menu").is(":hidden")) {
            if ($(e.target).closest(".login-modal-left,.login-modal-menu").length == 0) {
                $(".login-modal-menu").hide();
            }
        }
    });
    $(".login-modal-left").click(function () {
        if($(".login-modal-menu").is(":hidden")){
            $(".login-modal-menu").show();
        }else{
            $(".login-modal-menu").hide();
        }
    });
    $(document).on('click','.login-modal-menu>li',function () {
        var key=$(this).attr("key");
        $(".login-modal-left").text("（+"+key+"）");
        $(".login-modal-menu").attr("data-key","+"+key);
        $(".login-modal-menu").hide();
    });
    $(".login-modal-tab>li").click(function () {
        var tabindex=$(this).attr("tabindex");
        $(this).addClass("login-modal-active").siblings().removeClass("login-modal-active");
        $(".login-content>.login-content-"+tabindex).show().siblings().hide();
    });
    function GetCode(className){
        var wait=60;
        function time(className) {
            if (wait == 0) {
                $("."+className).removeClass("default");
                $("."+className).text("重新发送");
                wait = 60;
            } else {
                $("."+className).addClass("default");
                $("."+className).text( wait + " 秒");
                wait--;
                setTimeout(function () {
                    time(className);
                },1000);
            }
        }
        time(className);
    }

    $(".phone-code").click(function () {
        GetCode("phone-code");
    });
    $(".email-code").click(function () {
        GetCode("email-code");
    });
    $('#input-login').iCheck({
        checkboxClass: 'icheckbox_minimal-blue',
        increaseArea: '20%'
    });
    $(".register-tab>li").click(function () {
        var tabindex=$(this).attr("tabindex");
        $("#register-type").val(tabindex);
        $(this).addClass("register-tab-active").siblings().removeClass("register-tab-active");
        $(".register-content>.register-content-"+tabindex).show().siblings().hide();
    });
    $(".login-modal-btn").click(function () {
        login();
    });
    $("body").keydown(function() {
        if (event.keyCode == "13") {//keyCode=13是回车键；数字不同代表监听的按键不同
            login();
        }
    });
    function login() {
        var type = $("#register-type").val();
        if(type == 1){
            var telephoneCode = $("#phone-key").attr("data-key");
            var thisReg = reg(telephoneCode);
            var codereg = /^\d{6}$/;
            var myreg = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,15}$/;
            var mobile = $("#phone-input").val();
            var phoneCaptcha = $("#phone-captcha").val();
            var phonePassword = $("#phone-password").val();
            if(mobile==""){
                $(".login-modal-tips").show().text("请输入手机号");
            }else if(!thisReg.test(mobile)){
                $(".login-modal-tips").show().text("手机格式不正确");
            }else if(phoneCaptcha==""){
                $(".login-modal-tips").show().text("请输入手机验证码");
            }else if(!codereg.test(phoneCaptcha)){
                $(".login-modal-tips").show().text("验证码错误");
            }else if(phonePassword==""){
                $(".login-modal-tips").show().text("请输入密码");
            }else if(!myreg.test(phonePassword)){
                $(".login-modal-tips").text("密码格式不正确，请重新输入").show();
            }else{
                $.ajax({
                    url:url+'/register',
                    type:'POST',
                    async:true,//或false,是否异步,
                    timeout:5000,//超时时间
                    dataType:'json',
                    data:{type:2,telephoneCode:telephoneCode,mobile:mobile,password:hex_md5(phonePassword),captcha:phoneCaptcha},
                    success:function(data){
                        //console.log(data);
                        if(data.code=="0"){
                            swal({
                                title: "注册成功!",
                                text: '2秒后自动关闭',
                                type: "success",
                                timer:2000,
                                showConfirmButton: false
                            },function () {
                                $.cookie('token', data.info.token);
                                location.href = "index.html";
                            });
                        }else{
                            $(".login-modal-tips").text(data.msg).show();
                        }
                    },
                    error:function(){
                        console.log('错误')
                    }
                });
            }
        }else{
            var emailReg = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$");;
            var codereg = /^\d{6}$/;
            var myreg = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,15}$/;
            var email = $("#email-input").val();
            var emailCaptcha = $("#email-captcha").val();
            var emailPassword = $("#email-password").val();
            if(email==""){
                $(".login-modal-tips").show().text("请输入邮箱");
            }else if(!emailReg.test(email)){
                $(".login-modal-tips").show().text("邮箱格式不正确");
            }else if(emailCaptcha==""){
                $(".login-modal-tips").show().text("请输入邮箱验证码");
            }else if(!codereg.test(emailCaptcha)){
                $(".login-modal-tips").show().text("验证码错误");
            }else if(emailPassword==""){
                $(".login-modal-tips").show().text("请输入密码");
            }else if(!myreg.test(emailPassword)){
                $(".login-modal-tips").text("密码格式不正确，请重新输入").show();
            }else{
                $.ajax({
                    url:url+'/register',
                    type:'POST',
                    async:true,//或false,是否异步,
                    timeout:5000,//超时时间
                    dataType:'json',
                    data:{type:3,email:email,password:hex_md5(emailPassword),captcha:emailCaptcha},
                    success:function(data){
                        if(data.code=="0"){
                            swal({
                                title: "注册成功!",
                                text: '2秒后自动关闭',
                                type: "success",
                                timer:2000,
                                showConfirmButton: false
                            },function () {
                                $.cookie('token', data.info.token);
                                location.href = "index.html";
                            });
                        }else{
                            $(".login-modal-tips").text(data.msg).show();
                        }
                    },
                    error:function(){
                        console.log('错误')
                    }
                });
            }
        }
    }
    function reg(data){
        var myreg="";
        switch (data){
            case "+86":
                myreg = /^1\d{10}$/;
                break;
        }
        return myreg
    }
    $(".login-modal-form input").focus(function () {
        $(".login-modal-tips").hide();
    });
</script>
</html>